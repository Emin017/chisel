<!DOCTYPE html><html><head><title>Chisel/FIRRTL: Optional Groups</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="the Chisel/FIRRTL Developers" /><meta name="description" content="Chisel/FIRRTL
Hardware Compiler Framework" /><meta name="og:image" content="/img/poster.png" /><meta name="image" property="og:image" content="/img/poster.png" /><meta name="og:title" content="Chisel/FIRRTL: Optional Groups" /><meta name="title" property="og:title" content="Chisel/FIRRTL: Optional Groups" /><meta name="og:site_name" content="Chisel/FIRRTL" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Chisel/FIRRTL
Hardware Compiler Framework" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="Chisel/FIRRTL: Optional Groups" /><meta name="twitter:image" content="https://chipsalliance.github.io//img/poster.png" /><meta name="twitter:description" content="Chisel/FIRRTL
Hardware Compiler Framework" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="@chisel_lang" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/vs.css" /><link rel="stylesheet" href="/css/pattern-style.css" /><script async="async">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-145179088-1' , 'auto');
ga('send', 'pageview');
      </script></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"><span>Chisel/FIRRTL</span></div></a></li> <li><a href="/chisel3/docs/introduction.html" class="">Chisel3</a></li> <li><a href="/chisel3/docs/resources/resources.html" class="">Resources</a> <ul class="sub-section"> <li><a href="/chisel3/docs/resources/faqs.html" class="">FAQ</a></li></ul></li> <li><a href="/chisel3/docs/cookbooks/cookbooks.html" class="">Cookbooks</a> <ul class="sub-section"> <li><a href="/chisel3/docs/cookbooks/cookbook.html" class="">General Cookbook</a></li> <li><a href="/chisel3/docs/cookbooks/naming.html" class="">Naming Cookbook</a></li> <li><a href="/chisel3/docs/cookbooks/troubleshooting.html" class="">Troubleshooting</a></li> <li><a href="/chisel3/docs/cookbooks/dataview.html" class="">DataView Cookbook</a></li> <li><a href="/chisel3/docs/cookbooks/hierarchy.html" class="">Hierarchy Cookbook</a></li></ul></li> <li><a href="/chisel3/docs/explanations/explanations.html" class="">Explanations</a> <ul class="sub-section"> <li><a href="/chisel3/docs/explanations/motivation.html" class="">Motivation</a></li> <li><a href="/chisel3/docs/explanations/supported-hardware.html" class="">Supported Hardware</a></li> <li><a href="/chisel3/docs/explanations/data-types.html" class="">Data Types</a></li> <li><a href="/chisel3/docs/explanations/bundles-and-vecs.html" class="">Bundles and Vecs</a></li> <li><a href="/chisel3/docs/explanations/combinational-circuits.html" class="">Combinational Circuits</a></li> <li><a href="/chisel3/docs/explanations/operators.html" class="">Operators</a></li> <li><a href="/chisel3/docs/explanations/width-inference.html" class="">Width Inference</a></li> <li><a href="/chisel3/docs/explanations/functional-abstraction.html" class="">Functional Abstraction</a></li> <li><a href="/chisel3/docs/explanations/ports.html" class="">Ports</a></li> <li><a href="/chisel3/docs/explanations/modules.html" class="">Modules</a></li> <li><a href="/chisel3/docs/explanations/sequential-circuits.html" class="">Sequential Circuits</a></li> <li><a href="/chisel3/docs/explanations/memories.html" class="">Memories</a></li> <li><a href="/chisel3/docs/explanations/interfaces-and-connections.html" class="">Interfaces and Connections</a></li> <li><a href="/chisel3/docs/explanations/blackboxes.html" class="">Blackboxes</a></li> <li><a href="/chisel3/docs/explanations/chisel-enum.html" class="">Enumerations</a></li> <li><a href="/chisel3/docs/explanations/dataview.html" class="">DataView</a></li> <li><a href="/chisel3/docs/explanations/functional-module-creation.html" class="">Functional Module Creation</a></li> <li><a href="/chisel3/docs/explanations/muxes-and-input-selection.html" class="">Muxes and Input Selection</a></li> <li><a href="/chisel3/docs/explanations/multi-clock.html" class="">Multiple Clock Domains</a></li> <li><a href="/chisel3/docs/explanations/reset.html" class="">Reset</a></li> <li><a href="/chisel3/docs/explanations/polymorphism-and-parameterization.html" class="">Polymorphism and Parameterization</a></li> <li><a href="/chisel3/docs/explanations/printing.html" class="">Printing in Chisel</a></li> <li><a href="/chisel3/docs/explanations/naming.html" class="">Naming</a></li> <li><a href="/chisel3/docs/explanations/unconnected-wires.html" class="">Unconnected Wires</a></li> <li><a href="/chisel3/docs/explanations/chisel-type-vs-scala-type.html" class="">Chisel Type vs Scala Type</a></li> <li><a href="/chisel3/docs/explanations/connectable.html" class="">Connectable Operators</a></li> <li><a href="/chisel3/docs/explanations/decoder.html" class="">Decoders</a></li> <li><a href="/chisel3/docs/explanations/intrinsics.html" class="">Intrinsic Modules</a></li> <li><a href="/chisel3/docs/explanations/annotations.html" class="">Annotations</a></li> <li><a href="/chisel3/docs/explanations/source-locators.html" class="">Source Locators</a></li> <li><a href="/chisel3/docs/explanations/warnings.html" class="">Warnings</a></li> <li><a href="/chisel3/docs/explanations/connection-operators.html" class="">Deep Dive into Connection Operators</a></li> <li><a href="/chisel3/docs/explanations/properties.html" class="">Properties</a></li> <li><a href="/chisel3/docs/explanations/optional-groups.html" class=" active ">Optional Groups</a></li></ul></li> <li><a href="/chisel3/docs/appendix/appendix.html" class="">Appendix</a> <ul class="sub-section"> <li><a href="/chisel3/docs/appendix/chisel3-vs-chisel2.html" class="">Chisel3 vs. Chisel2</a></li> <li><a href="/chisel3/docs/appendix/experimental-features.html" class="">Experimental Features</a></li> <li><a href="/chisel3/docs/appendix/versioning.html" class="">Versioning</a></li> <li><a href="/chisel3/docs/appendix/upgrading-from-chisel-3-4.html" class="">Upgrading From Chisel 3.4 to 3.5</a></li> <li><a href="/chisel3/docs/appendix/upgrading-from-scala-2-11.html" class="">Upgrading From Scala 2.11</a></li></ul></li> <li><a href="/chisel3/docs/developers/developers.html" class="">Developers</a> <ul class="sub-section"> <li><a href="/chisel3/docs/developers/style.html" class="">Style Guide</a></li> <li><a href="/chisel3/docs/developers/sbt-subproject.html" class="">sbt Subproject</a></li> <li><a href="/chisel3/docs/developers/test-coverage.html" class="">Test Coverage</a></li></ul></li> <li><a href="/api/" class="">API Documentation</a> <ul class="sub-section"> <li><a href="/api/chisel/latest/" class="">Latest</a></li> <li><a href="/api/chisel/6.0/" class="">6.0</a></li> <li><a href="/api/chisel/5.0/" class="">5.0</a></li> <li><a href="/api/chisel3/3.6/" class="">3.6</a></li> <li><a href="/api/chisel3/3.5/" class="">3.5</a></li></ul></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="search-nav hidden-xs hidden-sm"><div id="search-dropdown"><label><i class="fa fa-search"></i>Search</label><input id="search-bar" type="text" placeholder="Enter keywords here..." onclick="displayToggleSearch(event)" /><ul id="search-dropdown-content" class="dropdown dropdown-content"></ul></div></li></ul></div></div></div></div><div id="content" data-github-owner="chipsalliance" data-github-repo="chisel"><div class="content-wrapper"><section><h1 id="optional-groups">Optional Groups</h1>

<p>Optional Groups are used to describe functionality of a Chisel module that a
user would like to <em>optionally</em> include in the final design.  This feature can
be used to optionally include verification or debug logic that a user does not
want to have present in the final design.</p>

<p>Each optional group is broken into two pieces:</p>

<ol>
  <li>A <em>declaration</em> of an optional group</li>
  <li>One or more <em>definitions</em> of an optional group inside a module</li>
</ol>

<p>A <em>declaration</em> of an optional group indicates that optional functionality may
exist in a Chisel circuit.  Declarations may be nested.  Declarations specify
the <em>convention</em> that they use when lowering to Verilog.</p>

<p>To declare an optional group, extend the <code class="language-plaintext highlighter-rouge">chisel3.group.Declaration</code> abstract
class and specify a convention.  To declare a nested optional group, extend the
<code class="language-plaintext highlighter-rouge">chisel3.group.Declaration</code> abstract class inside another declaration.</p>

<p>The following example declares four optional groups:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">chisel3.group.</span><span class="o">{</span><span class="nc">Convention</span><span class="o">,</span> <span class="nc">Declaration</span><span class="o">}</span>

<span class="k">object</span> <span class="nc">A</span> <span class="k">extends</span> <span class="nc">Declaration</span><span class="o">(</span><span class="nv">Convention</span><span class="o">.</span><span class="py">Bind</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">object</span> <span class="nc">B</span> <span class="k">extends</span> <span class="nc">Declaration</span><span class="o">(</span><span class="nv">Convention</span><span class="o">.</span><span class="py">Bind</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">object</span> <span class="nc">C</span> <span class="k">extends</span> <span class="nc">Declaration</span><span class="o">(</span><span class="nv">Convention</span><span class="o">.</span><span class="py">Bind</span><span class="o">)</span>
  <span class="o">}</span>
  <span class="k">object</span> <span class="nc">D</span> <span class="k">extends</span> <span class="nc">Declaration</span><span class="o">(</span><span class="nv">Convention</span><span class="o">.</span><span class="py">Bind</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>A <em>definition</em> of an optional group adds optional functionality to a module.
Each definition must refer to a declaration of an optional group.  Definitions
must match the nesting of their declarations.</p>

<p>To define an optional group, use the <code class="language-plaintext highlighter-rouge">chisel3.group</code> apply method referring to a
previously declared optional group inside a Chisel module.  An optional group
definition may use any Chisel or Scala value visible to its Scala lexical scope.</p>

<p>The following example defines four optional groups inside module <code class="language-plaintext highlighter-rouge">Foo</code> and
declares wires which are connected to values captured from visible lexical
scope:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">chisel3._</span>
<span class="k">import</span> <span class="nn">chisel3.group</span>

<span class="k">class</span> <span class="nc">Foo</span> <span class="k">extends</span> <span class="nc">RawModule</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">port</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="nc">Input</span><span class="o">(</span><span class="nc">Bool</span><span class="o">()))</span>

  <span class="nf">group</span><span class="o">(</span><span class="n">A</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">a</span> <span class="k">=</span> <span class="nc">WireInit</span><span class="o">(</span><span class="n">port</span><span class="o">)</span>
    <span class="nf">group</span><span class="o">(</span><span class="nv">A</span><span class="o">.</span><span class="py">B</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">val</span> <span class="nv">b</span> <span class="k">=</span> <span class="nc">WireInit</span><span class="o">(</span><span class="n">a</span><span class="o">)</span>
      <span class="nf">group</span><span class="o">(</span><span class="nv">A</span><span class="o">.</span><span class="py">B</span><span class="o">.</span><span class="py">C</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">val</span> <span class="nv">c</span> <span class="k">=</span> <span class="nc">WireInit</span><span class="o">(</span><span class="n">b</span><span class="o">)</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="nf">group</span><span class="o">(</span><span class="nv">A</span><span class="o">.</span><span class="py">D</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">val</span> <span class="nv">d</span> <span class="k">=</span> <span class="nc">WireInit</span><span class="o">(</span><span class="n">port</span> <span class="o">^</span> <span class="n">a</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="conventions">Conventions</h2>

<p>Currently, there is only one supported convetion, <code class="language-plaintext highlighter-rouge">Bind</code>.  This will cause
optional group definitions to be lowered to Verilog modules that are
instantiated via the SystemVerilog <code class="language-plaintext highlighter-rouge">bind</code> mechanism.  The lowering to Verilog of
nested groups avoids illegal nested usage of <code class="language-plaintext highlighter-rouge">bind</code>.</p>

<p>More conventions may be supported in the future.</p>

<h2 id="examples">Examples</h2>

<h3 id="design-verification-example">Design Verification Example</h3>

<p>Consider a use case where a design or design verification engineer would like to
add some asserts and debug prints to a module.  The logic necessary for the
asserts and debug prints requires additional computation.  All of this code
should not be included in the final Verilog.  The engineer can use three
optional groups to do this.</p>

<p>There are three optional groups that emerge from this example:</p>

<ol>
  <li>A common <code class="language-plaintext highlighter-rouge">Verification</code> group</li>
  <li>An <code class="language-plaintext highlighter-rouge">Assert</code> group nested under the <code class="language-plaintext highlighter-rouge">Verification</code> group</li>
  <li>A <code class="language-plaintext highlighter-rouge">Debug</code> group also nested under the <code class="language-plaintext highlighter-rouge">Verification</code> group</li>
</ol>

<p>The <code class="language-plaintext highlighter-rouge">Verification</code> group can be used to store common logic used by both the
<code class="language-plaintext highlighter-rouge">Assert</code> and <code class="language-plaintext highlighter-rouge">Debug</code> groups.  The latter two groups allow for separation of,
respectively, assertions from prints.</p>

<p>One way to write this in Scala is the following:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">chisel3._</span>
<span class="k">import</span> <span class="nn">chisel3.group.</span><span class="o">{</span><span class="nc">Convention</span><span class="o">,</span> <span class="nc">Declaration</span><span class="o">}</span>

<span class="c1">// All groups are declared here.  The Assert and Debug groups are nested under</span>
<span class="c1">// the Verification group.</span>
<span class="k">object</span> <span class="nc">Verification</span> <span class="k">extends</span> <span class="nv">group</span><span class="o">.</span><span class="py">Declaration</span><span class="o">(</span><span class="nv">group</span><span class="o">.</span><span class="py">Convention</span><span class="o">.</span><span class="py">Bind</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">object</span> <span class="nc">Assert</span> <span class="k">extends</span> <span class="nv">group</span><span class="o">.</span><span class="py">Declaration</span><span class="o">(</span><span class="nv">group</span><span class="o">.</span><span class="py">Convention</span><span class="o">.</span><span class="py">Bind</span><span class="o">)</span>
  <span class="k">object</span> <span class="nc">Debug</span> <span class="k">extends</span> <span class="nv">group</span><span class="o">.</span><span class="py">Declaration</span><span class="o">(</span><span class="nv">group</span><span class="o">.</span><span class="py">Convention</span><span class="o">.</span><span class="py">Bind</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">Foo</span> <span class="k">extends</span> <span class="nc">Module</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">a</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="nc">Input</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">32.</span><span class="n">W</span><span class="o">)))</span>
  <span class="k">val</span> <span class="nv">b</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="nc">Output</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">32.</span><span class="n">W</span><span class="o">)))</span>

  <span class="n">b</span> <span class="o">:=</span> <span class="n">a</span> <span class="o">+%</span> <span class="mf">1.</span><span class="n">U</span>

  <span class="c1">// This defines the `Verification` group inside Foo.</span>
  <span class="nf">group</span><span class="o">(</span><span class="nc">Verification</span><span class="o">)</span> <span class="o">{</span>

    <span class="c1">// Some common logic added here.  The input port `a` is "captured" and</span>
    <span class="c1">// used here.</span>
    <span class="k">val</span> <span class="nv">a_d0</span> <span class="k">=</span> <span class="nc">RegNext</span><span class="o">(</span><span class="n">a</span><span class="o">)</span>

    <span class="c1">// This defines the `Assert` group.</span>
    <span class="nf">group</span><span class="o">(</span><span class="nv">Verification</span><span class="o">.</span><span class="py">Assert</span><span class="o">)</span> <span class="o">{</span>
      <span class="nv">chisel3</span><span class="o">.</span><span class="py">assert</span><span class="o">(</span><span class="n">a</span> <span class="o">&gt;=</span> <span class="n">a_d0</span><span class="o">,</span> <span class="s">"a must always increment"</span><span class="o">)</span>
    <span class="o">}</span>

    <span class="c1">// This defines the `Debug` group.</span>
    <span class="nf">group</span><span class="o">(</span><span class="nv">Verification</span><span class="o">.</span><span class="py">Debug</span><span class="o">)</span> <span class="o">{</span>
      <span class="nf">printf</span><span class="o">(</span><span class="s">"a: %x, a_d0: %x"</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="n">a_d0</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<p>After compilation, this will produce three group include files with the
following filenames.  One file is created for each optional group:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">groups_Foo_Verification.sv</code></li>
  <li><code class="language-plaintext highlighter-rouge">groups_Foo_Verification_Assert.sv</code></li>
  <li><code class="language-plaintext highlighter-rouge">groups_Foo_Verification_Debug.sv</code></li>
</ol>

<p>A user can then include any combination of these files in their design to
include the optional functionality describe by the <code class="language-plaintext highlighter-rouge">Verification</code>, <code class="language-plaintext highlighter-rouge">Assert</code>, or
<code class="language-plaintext highlighter-rouge">Debug</code> groups.  The <code class="language-plaintext highlighter-rouge">Assert</code> and <code class="language-plaintext highlighter-rouge">Debug</code> bind files automatically include the
<code class="language-plaintext highlighter-rouge">Verification</code> bind file for the user.</p>

<h4 id="implementation-notes">Implementation Notes</h4>

<p><em>Note: the names of the modules and the names of any files that contain these
modules are FIRRTL compiler implementation defined!  The only guarantee is the
existence of the three group include files.  The information in this subsection
is for informational purposes to aid understanding.</em></p>

<p>In implementation, a FIRRTL compiler creates four Verilog modules for the
circuit above (one for <code class="language-plaintext highlighter-rouge">Foo</code> and one for each optional group definition in
module <code class="language-plaintext highlighter-rouge">Foo</code>):</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">Foo</code></li>
  <li><code class="language-plaintext highlighter-rouge">Foo_Verification</code></li>
  <li><code class="language-plaintext highlighter-rouge">Foo_Verification_Assert</code></li>
  <li><code class="language-plaintext highlighter-rouge">Foo_Verification_Debug</code></li>
</ol>

<p>These will typically be created in separate files with names that match the
modules, i.e., <code class="language-plaintext highlighter-rouge">Foo.sv</code>, <code class="language-plaintext highlighter-rouge">Foo_Verification.sv</code>, <code class="language-plaintext highlighter-rouge">Foo_Verification_Assert.sv</code>,
and <code class="language-plaintext highlighter-rouge">Foo_Verification_Debug.sv</code>.</p>

<p>The ports of each module created from an optional group definition will be
automatically determined based on what that group captured from outside the
group.  In the example above, the <code class="language-plaintext highlighter-rouge">Verification</code> group definition captured port
<code class="language-plaintext highlighter-rouge">a</code>.  Both the <code class="language-plaintext highlighter-rouge">Assert</code> and <code class="language-plaintext highlighter-rouge">Debug</code> group definitions captured <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">a_d0</code>.
Groups may be optimized to remove/add ports or to move logic into an optional
group.</p>

<h4 id="verilog-output">Verilog Output</h4>

<p>The complete Verilog output for this example is reproduced below:</p>

<div class="language-verilog highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Generated by CIRCT firtool-1.59.0</span>
<span class="c1">// Standard header to adapt well known macros to our needs.</span>

<span class="c1">// Users can define 'PRINTF_COND' to add an extra gate to prints.</span>
<span class="cp">`ifndef</span> <span class="n">PRINTF_COND_</span>
  <span class="cp">`ifdef</span> <span class="n">PRINTF_COND</span>
    <span class="cp">`define</span> PRINTF_COND_ <span class="err">(`</span>PRINTF_COND<span class="err">)</span><span class="cp">
</span>  <span class="cp">`else</span>  <span class="c1">// PRINTF_COND</span>
    <span class="cp">`define</span> PRINTF_COND_ 1<span class="cp">
</span>  <span class="cp">`endif</span> <span class="c1">// PRINTF_COND</span>
<span class="cp">`endif</span> <span class="c1">// not def PRINTF_COND_</span>

<span class="c1">// Users can define 'ASSERT_VERBOSE_COND' to add an extra gate to assert error printing.</span>
<span class="cp">`ifndef</span> <span class="n">ASSERT_VERBOSE_COND_</span>
  <span class="cp">`ifdef</span> <span class="n">ASSERT_VERBOSE_COND</span>
    <span class="cp">`define</span> ASSERT_VERBOSE_COND_ <span class="err">(`</span>ASSERT_VERBOSE_COND<span class="err">)</span><span class="cp">
</span>  <span class="cp">`else</span>  <span class="c1">// ASSERT_VERBOSE_COND</span>
    <span class="cp">`define</span> ASSERT_VERBOSE_COND_ 1<span class="cp">
</span>  <span class="cp">`endif</span> <span class="c1">// ASSERT_VERBOSE_COND</span>
<span class="cp">`endif</span> <span class="c1">// not def ASSERT_VERBOSE_COND_</span>

<span class="c1">// Users can define 'STOP_COND' to add an extra gate to stop conditions.</span>
<span class="cp">`ifndef</span> <span class="n">STOP_COND_</span>
  <span class="cp">`ifdef</span> <span class="n">STOP_COND</span>
    <span class="cp">`define</span> STOP_COND_ <span class="err">(`</span>STOP_COND<span class="err">)</span><span class="cp">
</span>  <span class="cp">`else</span>  <span class="c1">// STOP_COND</span>
    <span class="cp">`define</span> STOP_COND_ 1<span class="cp">
</span>  <span class="cp">`endif</span> <span class="c1">// STOP_COND</span>
<span class="cp">`endif</span> <span class="c1">// not def STOP_COND_</span>

<span class="k">module</span> <span class="n">Foo_Verification_Assert</span><span class="p">(</span>
  <span class="kt">input</span> <span class="p">[</span><span class="mi">31</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="mi">_</span><span class="n">a</span><span class="p">,</span>
               <span class="mi">_</span><span class="n">a_d0</span><span class="p">,</span>
  <span class="kt">input</span>        <span class="mi">_</span><span class="n">reset</span><span class="p">,</span>
               <span class="mi">_</span><span class="n">clock</span>
<span class="p">);</span>

  <span class="cp">`ifndef</span> <span class="n">SYNTHESIS</span>
    <span class="k">always</span> <span class="o">@</span><span class="p">(</span><span class="kt">posedge</span> <span class="mi">_</span><span class="n">clock</span><span class="p">)</span> <span class="k">begin</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">~</span><span class="mi">_</span><span class="n">reset</span> <span class="o">&amp;</span> <span class="mi">_</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">_</span><span class="n">a_d0</span><span class="p">)</span> <span class="k">begin</span>
        <span class="k">if</span> <span class="p">(</span><span class="cp">`ASSERT_VERBOSE_COND_</span><span class="p">)</span>
          <span class="p">$</span><span class="nb">error</span><span class="p">(</span><span class="s">"Assertion failed: a must always increment</span><span class="se">\n</span><span class="s">    at optional-groups.md:79 chisel3.assert(a &gt;= a_d0, </span><span class="se">\"</span><span class="s">a must always increment</span><span class="se">\"</span><span class="s">)</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="cp">`STOP_COND_</span><span class="p">)</span>
          <span class="p">$</span><span class="n">fatal</span><span class="p">;</span>
      <span class="k">end</span>
    <span class="k">end</span> <span class="c1">// always @(posedge)</span>
  <span class="cp">`endif</span> <span class="c1">// not def SYNTHESIS</span>
<span class="k">endmodule</span>

<span class="k">module</span> <span class="n">Foo_Verification_Debug</span><span class="p">(</span>
  <span class="kt">input</span>        <span class="mi">_</span><span class="n">reset</span><span class="p">,</span>
               <span class="mi">_</span><span class="n">clock</span><span class="p">,</span>
  <span class="kt">input</span> <span class="p">[</span><span class="mi">31</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="mi">_</span><span class="n">a</span><span class="p">,</span>
               <span class="mi">_</span><span class="n">a_d0</span>
<span class="p">);</span>

  <span class="cp">`ifndef</span> <span class="n">SYNTHESIS</span>
    <span class="k">always</span> <span class="o">@</span><span class="p">(</span><span class="kt">posedge</span> <span class="mi">_</span><span class="n">clock</span><span class="p">)</span> <span class="k">begin</span>
      <span class="k">if</span> <span class="p">((</span><span class="cp">`PRINTF_COND_</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mi">_</span><span class="n">reset</span><span class="p">)</span>
        <span class="p">$</span><span class="nb">fwrite</span><span class="p">(</span><span class="mh">32'h80000002</span><span class="p">,</span> <span class="s">"a: %x, a_d0: %x"</span><span class="p">,</span> <span class="mi">_</span><span class="n">a</span><span class="p">,</span> <span class="mi">_</span><span class="n">a_d0</span><span class="p">);</span>
    <span class="k">end</span> <span class="c1">// always @(posedge)</span>
  <span class="cp">`endif</span> <span class="c1">// not def SYNTHESIS</span>
<span class="k">endmodule</span>

<span class="k">module</span> <span class="n">Foo_Verification</span><span class="p">(</span>
  <span class="kt">input</span>        <span class="mi">_</span><span class="n">clock</span><span class="p">,</span>
  <span class="kt">input</span> <span class="p">[</span><span class="mi">31</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="mi">_</span><span class="n">a</span>
<span class="p">);</span>

  <span class="kt">wire</span>        <span class="mi">_</span><span class="n">clock_probe</span> <span class="o">=</span> <span class="mi">_</span><span class="n">clock</span><span class="p">;</span>
  <span class="kt">wire</span> <span class="p">[</span><span class="mi">31</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="mi">_</span><span class="n">a_probe</span> <span class="o">=</span> <span class="mi">_</span><span class="n">a</span><span class="p">;</span>
  <span class="kt">wire</span> <span class="p">[</span><span class="mi">31</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="mi">_</span><span class="n">a_probe_0</span> <span class="o">=</span> <span class="mi">_</span><span class="n">a</span><span class="p">;</span>
  <span class="kt">wire</span>        <span class="mi">_</span><span class="n">clock_probe_0</span> <span class="o">=</span> <span class="mi">_</span><span class="n">clock</span><span class="p">;</span>
  <span class="kt">reg</span>  <span class="p">[</span><span class="mi">31</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="n">a_d0</span><span class="p">;</span>
  <span class="kt">wire</span> <span class="p">[</span><span class="mi">31</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="n">a_d0_probe</span> <span class="o">=</span> <span class="n">a_d0</span><span class="p">;</span>
  <span class="kt">wire</span> <span class="p">[</span><span class="mi">31</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="n">a_d0_probe_0</span> <span class="o">=</span> <span class="n">a_d0</span><span class="p">;</span>
  <span class="k">always</span> <span class="o">@</span><span class="p">(</span><span class="kt">posedge</span> <span class="mi">_</span><span class="n">clock</span><span class="p">)</span>
    <span class="n">a_d0</span> <span class="o">&lt;=</span> <span class="mi">_</span><span class="n">a</span><span class="p">;</span>
<span class="k">endmodule</span>

<span class="k">module</span> <span class="n">Foo</span><span class="p">(</span>
  <span class="kt">input</span>         <span class="n">clock</span><span class="p">,</span>
                <span class="n">reset</span><span class="p">,</span>
  <span class="kt">input</span>  <span class="p">[</span><span class="mi">31</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="n">a</span><span class="p">,</span>
  <span class="kt">output</span> <span class="p">[</span><span class="mi">31</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="n">b</span>
<span class="p">);</span>

  <span class="k">assign</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="mh">32'h1</span><span class="p">;</span>
<span class="k">endmodule</span>


<span class="c1">// ----- 8&lt; ----- FILE "groups_Foo_Verification_Debug.sv" ----- 8&lt; -----</span>

<span class="c1">// Generated by CIRCT firtool-1.59.0</span>
<span class="cp">`include</span> <span class="s">"groups_Foo_Verification.sv"</span>
<span class="cp">`ifndef</span> <span class="n">groups_Foo_Verification_Debug</span>
<span class="cp">`define</span> groups_Foo_Verification_Debug<span class="cp">
</span><span class="k">bind</span> <span class="n">Foo</span> <span class="n">Foo_Verification_Debug</span> <span class="n">foo_Verification_Debug</span> <span class="p">(</span>
  <span class="mf">._</span><span class="n">reset</span> <span class="p">(</span><span class="n">reset</span><span class="p">),</span>
  <span class="mf">._</span><span class="n">clock</span> <span class="p">(</span><span class="n">Foo</span><span class="p">.</span><span class="n">foo_Verification</span><span class="mf">._</span><span class="n">clock_probe_0</span><span class="p">),</span>
  <span class="mf">._</span><span class="n">a</span>     <span class="p">(</span><span class="n">Foo</span><span class="p">.</span><span class="n">foo_Verification</span><span class="mf">._</span><span class="n">a_probe_0</span><span class="p">),</span>
  <span class="mf">._</span><span class="n">a_d0</span>  <span class="p">(</span><span class="n">Foo</span><span class="p">.</span><span class="n">foo_Verification</span><span class="p">.</span><span class="n">a_d0_probe_0</span><span class="p">)</span>
<span class="p">);</span>
<span class="cp">`endif</span> <span class="c1">// groups_Foo_Verification_Debug</span>

<span class="c1">// ----- 8&lt; ----- FILE "groups_Foo_Verification_Assert.sv" ----- 8&lt; -----</span>

<span class="c1">// Generated by CIRCT firtool-1.59.0</span>
<span class="cp">`include</span> <span class="s">"groups_Foo_Verification.sv"</span>
<span class="cp">`ifndef</span> <span class="n">groups_Foo_Verification_Assert</span>
<span class="cp">`define</span> groups_Foo_Verification_Assert<span class="cp">
</span><span class="k">bind</span> <span class="n">Foo</span> <span class="n">Foo_Verification_Assert</span> <span class="n">foo_Verification_Assert</span> <span class="p">(</span>
  <span class="mf">._</span><span class="n">a</span>     <span class="p">(</span><span class="n">Foo</span><span class="p">.</span><span class="n">foo_Verification</span><span class="mf">._</span><span class="n">a_probe</span><span class="p">),</span>
  <span class="mf">._</span><span class="n">a_d0</span>  <span class="p">(</span><span class="n">Foo</span><span class="p">.</span><span class="n">foo_Verification</span><span class="p">.</span><span class="n">a_d0_probe</span><span class="p">),</span>
  <span class="mf">._</span><span class="n">reset</span> <span class="p">(</span><span class="n">reset</span><span class="p">),</span>
  <span class="mf">._</span><span class="n">clock</span> <span class="p">(</span><span class="n">Foo</span><span class="p">.</span><span class="n">foo_Verification</span><span class="mf">._</span><span class="n">clock_probe</span><span class="p">)</span>
<span class="p">);</span>
<span class="cp">`endif</span> <span class="c1">// groups_Foo_Verification_Assert</span>

<span class="c1">// ----- 8&lt; ----- FILE "groups_Foo_Verification.sv" ----- 8&lt; -----</span>

<span class="c1">// Generated by CIRCT firtool-1.59.0</span>
<span class="cp">`ifndef</span> <span class="n">groups_Foo_Verification</span>
<span class="cp">`define</span> groups_Foo_Verification<span class="cp">
</span><span class="k">bind</span> <span class="n">Foo</span> <span class="n">Foo_Verification</span> <span class="n">foo_Verification</span> <span class="p">(</span>
  <span class="mf">._</span><span class="n">clock</span> <span class="p">(</span><span class="n">clock</span><span class="p">),</span>
  <span class="mf">._</span><span class="n">a</span>     <span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="p">);</span>
<span class="cp">`endif</span> <span class="c1">// groups_Foo_Verification</span>
</code></pre></div></div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/highlight/highlight.pack.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/verilog.min.js"></script><script src="/lunr/lunr.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash','verilog']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script>((window.gitter = {}).chat = {}).options = {
room: 'chipsalliance/chisel'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/js/search.js"></script><script src="/js/main.js"></script></body></html>